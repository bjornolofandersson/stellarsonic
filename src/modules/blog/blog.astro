---
import * as site from '@settings';
import { getCollection } from 'astro:content';
import Page from '@layouts/Page.astro'
import BlogTheme from '@theme/Blog.svelte';
import PostPreview from '@theme/PostPreview.svelte';
import { Blog } from './blog.server';
import Paginator from '@theme/common/Paginator.svelte';
import { Page as AstroPage } from 'astro';
import MenuBar from '@theme/MenuBar.svelte';

interface Props extends Blog {
  page: AstroPage;
}

const config = Astro.props;
const { pagination, page, path } = config;

const posts = await getCollection(config.posts.collection as any);
---

<Page editor="blog" editorProps={{...config, posts}}>
  <Fragment slot="head-bottom">
    <title>{config.title}</title>
  </Fragment>

  <BlogTheme genres={[]} client:load>
    <MenuBar slot="header" settings={site} />

    {pagination && <Paginator slot="paginator" page={page} path={path}/>}

    <Fragment slot="posts">
      {page.data.map(({data, slug}: any) =>
        <PostPreview collection={config.posts.collection} post={data} slug={slug} url={`/${path}/${slug}`} />
      )}
    </Fragment>
  </BlogTheme>
</Page>
