---
import { getCollection } from 'astro:content';
import { uniqueGenres } from '@lib/utils';
import { blogCollectionPaths } from '@lib/server';
import ArchiveContainer from '@layouts/Archive.astro';
import * as site from '@settings';
import Archive from '@theme/Archive.svelte';
import PostPreview from '@theme/PostPreview.svelte';
import SiteHero from '@theme/SiteHero.svelte';

export const getStaticPaths = blogCollectionPaths('mixes', site.blog.pageSize);

const { page } = Astro.props;

const posts = await getCollection('mixes');
const genres = uniqueGenres(posts.map(({ data }) => data) as any);

const {data, ...pageInfo} = page;
---

<ArchiveContainer collection="mixes" posts={posts}>
  <Archive page={pageInfo} genres={genres}>
    <SiteHero slot="header"/>
    <Fragment slot="posts">
      {page.data.map(({data, slug}: any) =>
        <PostPreview collection="mixes" post={data} slug={slug} />
      )}
    </Fragment>
  </Archive>
</ArchiveContainer>
