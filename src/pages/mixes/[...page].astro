---
import { getCollection } from 'astro:content';
import { uniqueGenres } from '@lib/utils';
import * as site from '@settings';
import Mixes from '@theme/layouts/Mixes.svelte';
import Preview from '@theme/components/playlist/Preview.svelte';
import SiteHero from '@theme/components/SiteHero.svelte';
import { blogCollectionPaths } from '@lib/server';
import Archive from '@layouts/Archive.astro';

export const getStaticPaths = blogCollectionPaths('mixes', site.blog.pageSize);

const { page } = Astro.props;

const posts = await getCollection('mixes');
const genres = uniqueGenres(posts.map(({ data }) => data) as any);

const {data, ...pageInfo} = page;
---

<Archive collection="mixes" posts={posts}>
  <Mixes page={pageInfo} genres={genres}>
    <SiteHero slot="header"/>
    <Fragment slot="posts">
      {page.data.map(({data, slug}: any) =>
        <Preview data={data} slug={slug} client:visible />
      )}
    </Fragment>
  </Mixes>
</Archive>
