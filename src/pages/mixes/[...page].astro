---
import { getCollection } from 'astro:content';
import { uniqueGenres } from '@lib/utils';
import * as site from '@settings';
import MixListEditor from '@components/editor/MixListEditor.svelte';
import Mixes from '@theme/layouts/Mixes.astro';
import Page from '@theme/layouts/Page.astro'
import SiteHero from '@theme/components/SiteHero.svelte';
import SettingsLoader from '@components/SettingsLoader.svelte';


export async function getStaticPaths({ paginate }: any) {
  const posts = await getCollection('mixes');
  const sortedPosts = posts.sort((a, b) => {
    //return b.data.date.localeCompare(a.data.date);
    return 1;
  });

  return paginate(sortedPosts, { pageSize: site.blog.pageSize });
}

const isDev = import.meta.env.MODE === 'development';
const { page } = Astro.props;

const genres = await getCollection('mixes').then(posts => {
  return uniqueGenres(posts.map(({ data }) => data) as any);
});

let slugs: string[] = [];
if (isDev) {
  const posts = await getCollection('mixes');
  slugs = posts.map(p => p.slug);
}
---

<Page>
  <SettingsLoader settings={site} client:load/>

  {isDev ?
    <MixListEditor slugs={slugs} client:only>
      <Mixes page={page} genres={genres}>
        <SiteHero slot="header"/>
      </Mixes>
    </MixListEditor>
  :
    <Mixes page={page} genres={genres}>
      <SiteHero slot="header"/>
    </Mixes>
  }
</Page>
