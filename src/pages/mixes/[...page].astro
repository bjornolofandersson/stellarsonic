---
import { getCollection } from 'astro:content';
import { uniqueGenres } from '@lib/utils';
import * as site from '@settings';
import MixListEditor from '@components/editor/MixListEditor.svelte';
import SettingsLoader from '@components/SettingsLoader.svelte';
import Page from '@layouts/Page.astro'
import Mixes from '@theme/layouts/Mixes.astro';
import SiteHero from '@theme/components/SiteHero.svelte';
import { blogCollectionPaths, collectionSlugs } from '@lib/server';

export const getStaticPaths = blogCollectionPaths('mixes', site.blog.pageSize);

const isDev = import.meta.env.MODE === 'development';
const { page } = Astro.props;

const genres = await getCollection('mixes').then(posts => {
  return uniqueGenres(posts.map(({ data }) => data) as any);
});

let slugs: string[] = [];
if (isDev) {
  slugs = await collectionSlugs('mixes');
}
const pageTitle = `Mixtapes | ${site.title}`
---

<Page>
  <Fragment slot="head-bottom">
    <title>{pageTitle}</title>
  </Fragment>

  <SettingsLoader settings={site} client:load/>

  {isDev ?
    <MixListEditor pageTitle={pageTitle} slugs={slugs} client:only>
      <Mixes page={page} genres={genres}>
        <SiteHero slot="header"/>
      </Mixes>
    </MixListEditor>
  :
    <Mixes page={page} genres={genres}>
      <SiteHero slot="header"/>
    </Mixes>
  }
</Page>
