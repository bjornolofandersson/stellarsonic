---
import { ServerModule } from '@lib/interfaces';
import { getCollection } from 'astro:content';


export async function getStaticPaths() {
  function getServerModules() {
    const modules = import.meta.glob('../modules/*/*.server.ts', {eager: true, });
    const result: Record<string, ServerModule> = {};
    for (const path in modules) {
      const name = path.substring(path.lastIndexOf('/') + 1).replace('.server.ts', '');
      result[name] = modules[path] as ServerModule;
    }
    return result;
  }

  const modules = getServerModules();
  const blogs = await getCollection('blogs');
  const pages = await getCollection('pages');
  let paths: any[] = [];

  for (const page of blogs) {
    paths = paths.concat(await modules['blog'].getStaticPaths(page));
  }
  for (const page of pages) {
    paths = paths.concat(await modules['page'].getStaticPaths(page));
  }

  return paths;
}

interface Props {
  Module: any;

  title: string;

  props: any;
}

const { title, Module, props } = Astro.props;
---

<Module title={title} {...props} />
