---
import { MusicMix } from '@lib/interfaces';
import Schema from '@components/MusicPlaylistSchema.astro';
import Tracks from '../components/playlist/Tracks.svelte';
import Controls from '../components/playlist/Controls.svelte';
import MusicPlaylist from './MusicPlaylist.svelte';
import Editor from './Editor.svelte';
import ClientPostLoader from './ClientPostLoader.svelte';
import Page from './Page.astro';

export interface Props {
  post: MusicMix;

  slug: string;
}

const isDev = import.meta.env.MODE === 'development';

const { post, slug } = Astro.props;
---
<Page>
  <Fragment slot="head-bottom">
    <Schema {...post} />
  </Fragment>
  <ClientPostLoader collection="mixes" slug={slug} client:only/>

  {isDev ?
    <Editor client:load>
      <MusicPlaylist post={post} client:load>
        <Tracks slot="tracks" client:only />
        <Controls slot="controls" client:only />

        <Fragment slot="article">
          <slot/>
        </Fragment>
      </MusicPlaylist>
    </Editor>
  :
    <MusicPlaylist post={post}>
      <Tracks slot="tracks" client:only />
      <Controls slot="controls" client:only />

      <Fragment slot="article">
        <slot/>
      </Fragment>
    </MusicPlaylist>
  }
</Page>
